<!doctype html>



  


<html class="theme-next mist use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>



<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />












  
  
    
  
  <link href="//cdn.jsdelivr.net/fancybox/2.1.5/jquery.fancybox.min.css" rel="stylesheet" type="text/css" />




  
  
  
  

  

  

  

  

  

  






  

<link href="//maxcdn.bootstrapcdn.com/font-awesome/4.6.2/css/font-awesome.min.css" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.0" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="idea," />





  <link rel="alternate" href="/atom.xml" title="是五月呀！" type="application/atom+xml" />




  <link rel="shortcut icon" type="image/x-icon" href="/images/favicon.ico?v=5.1.0" />






<meta name="description" content="从今天开始一步一步练习mybatis插件开发。 第一步是解析mapper文件，可以实现xml中按照id属性查找resultMap或者sql片段，鼠标点击跳转。 Dom操作Xml的基本只是可以参考之前的文章：IDEA插件开发（二）DOM操作XML文件 本文直接以mybatis的mapper文件解析为例，说明Dom操作的常用写法。">
<meta name="keywords" content="idea">
<meta property="og:type" content="article">
<meta property="og:title" content="IDEA插件开发（七）mybatis插件之mapper解析与converter">
<meta property="og:url" content="https://damon4u.github.io/blog/2018/10/IDEA插件开发（七）mybatis插件之mapper解析与converter.html">
<meta property="og:site_name" content="是五月呀！">
<meta property="og:description" content="从今天开始一步一步练习mybatis插件开发。 第一步是解析mapper文件，可以实现xml中按照id属性查找resultMap或者sql片段，鼠标点击跳转。 Dom操作Xml的基本只是可以参考之前的文章：IDEA插件开发（二）DOM操作XML文件 本文直接以mybatis的mapper文件解析为例，说明Dom操作的常用写法。">
<meta property="og:locale" content="zh-Hans">
<meta property="og:updated_time" content="2018-10-25T15:07:47.307Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="IDEA插件开发（七）mybatis插件之mapper解析与converter">
<meta name="twitter:description" content="从今天开始一步一步练习mybatis插件开发。 第一步是解析mapper文件，可以实现xml中按照id属性查找resultMap或者sql片段，鼠标点击跳转。 Dom操作Xml的基本只是可以参考之前的文章：IDEA插件开发（二）DOM操作XML文件 本文直接以mybatis的mapper文件解析为例，说明Dom操作的常用写法。">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Mist',
    sidebar: {"position":"right","display":"post"},
    fancybox: true,
    motion: true,
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="https://damon4u.github.io/blog/2018/10/IDEA插件开发（七）mybatis插件之mapper解析与converter.html"/>





  <title> IDEA插件开发（七）mybatis插件之mapper解析与converter | 是五月呀！ </title>
</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  










  
  
    
  

  <div class="container one-collumn sidebar-position-right page-post-detail ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-meta custom-logo">
  

  <div class="custom-logo-site-title">
    <a href="/"  class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <span class="site-title">是五月呀！</span>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>
    
      <h1 class="site-subtitle" itemprop="description"></h1>
    
</div>

<div class="site-nav-toggle">
  <button>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
  </button>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br />
            
            关于
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
  <link itemprop="mainEntityOfPage" href="https://damon4u.github.io/blog/2018/10/IDEA插件开发（七）mybatis插件之mapper解析与converter.html">

  <span style="display:none" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <meta itemprop="name" content="五月y">
    <meta itemprop="description" content="">
    <meta itemprop="image" content="/images/avatar2.jpg">
  </span>

  <span style="display:none" itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="是五月呀！">
    <span style="display:none" itemprop="logo" itemscope itemtype="http://schema.org/ImageObject">
      <img style="display:none;" itemprop="url image" alt="是五月呀！" src="/images/avatar2.jpg">
    </span>
  </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
            
            
              
                IDEA插件开发（七）mybatis插件之mapper解析与converter
              
            
          </h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2018-10-18T17:41:50+08:00">
                2018-10-18
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/idea/" itemprop="url" rel="index">
                    <span itemprop="name">idea</span>
                  </a>
                </span>

                
                
                  ， 
                
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/idea/java/" itemprop="url" rel="index">
                    <span itemprop="name">java</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          

          
          


         <span class="post-time">
         <span class="post-meta-divider">|</span>
           <span class="post-meta-item-icon">
             <i class="fa fa-calendar-o"></i>
           </span>
           <span class="post-meta-item-text">字数统计:</span>
           <span class="post-count">4,121(字)</span>

         </span>

         <span class="post-time">
         <span class="post-meta-divider">|</span>
           <span class="post-meta-item-icon">
             <i class="fa fa-calendar-o"></i>
           </span>
           <span class="post-meta-item-text">阅读时长:</span>
           <span class="post-count">18(分)</span>
         </span>

          

          




        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        <p>从今天开始一步一步练习mybatis插件开发。</p>
<p>第一步是解析mapper文件，可以实现xml中按照id属性查找resultMap或者sql片段，鼠标点击跳转。</p>
<p>Dom操作Xml的基本只是可以参考之前的文章：<a href="https://damon4u.github.io/blog/2018/10/IDEA%E6%8F%92%E4%BB%B6%E5%BC%80%E5%8F%91%EF%BC%88%E4%BA%8C%EF%BC%89DOM%E6%93%8D%E4%BD%9CXML%E6%96%87%E4%BB%B6.html#more">IDEA插件开发（二）DOM操作XML文件</a></p>
<p>本文直接以mybatis的mapper文件解析为例，说明Dom操作的常用写法。</p>
<a id="more"></a>
<p>使用Dom解析xml文件，首先需要按照xml包含的标签元素（DTD）编写对应的Java实体。<br>例如一个典型的mapper xml文件包含的标签元素为：<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div></pre></td><td class="code"><pre><div class="line">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</div><div class="line"><span class="meta">&lt;!DOCTYPE mapper</span></div><div class="line"><span class="meta">        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"</span></div><div class="line"><span class="meta">        "http://mybatis.org/dtd/mybatis-3-mapper.dtd"&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">"com.demo.dao.UserDao"</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">id</span>=<span class="string">"userMap"</span> <span class="attr">type</span>=<span class="string">"com.demo.entity.User"</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">id</span> <span class="attr">column</span>=<span class="string">"id"</span> <span class="attr">property</span>=<span class="string">"id"</span>/&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">"user_id"</span> <span class="attr">property</span>=<span class="string">"userId"</span>/&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">"user_name"</span> <span class="attr">property</span>=<span class="string">"userName"</span>/&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">association</span> <span class="attr">property</span>=<span class="string">"jobInfo"</span> <span class="attr">javaType</span>=<span class="string">"com.demo.entity.Job"</span></span></div><div class="line"><span class="tag">                    <span class="attr">resultMap</span>=<span class="string">"jobMap"</span>/&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></div><div class="line"></div><div class="line">    <span class="tag">&lt;<span class="name">sql</span>&gt;</span></div><div class="line"></div><div class="line">    <span class="tag">&lt;/<span class="name">sql</span>&gt;</span></div><div class="line"></div><div class="line">    <span class="tag">&lt;<span class="name">insert</span> <span class="attr">id</span>=<span class="string">"insertUser"</span> <span class="attr">parameterType</span>=<span class="string">"com.demo.entity.User"</span>&gt;</span></div><div class="line"></div><div class="line">    <span class="tag">&lt;/<span class="name">insert</span>&gt;</span></div><div class="line"></div><div class="line">    <span class="tag">&lt;<span class="name">delete</span> <span class="attr">id</span>=<span class="string">"deleteUser"</span>&gt;</span></div><div class="line"></div><div class="line">    <span class="tag">&lt;/<span class="name">delete</span>&gt;</span></div><div class="line"></div><div class="line">    <span class="tag">&lt;<span class="name">update</span> <span class="attr">id</span>=<span class="string">"updateUser"</span>&gt;</span></div><div class="line"></div><div class="line">    <span class="tag">&lt;/<span class="name">update</span>&gt;</span></div><div class="line"></div><div class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"getUser"</span> <span class="attr">resultMap</span>=<span class="string">"userMap"</span>&gt;</span></div><div class="line"></div><div class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></div></pre></td></tr></table></figure></p>
<p>转化为一个Java实体：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">Mapper</span> <span class="keyword">extends</span> <span class="title">DomElement</span> </span>&#123;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line"><span class="comment">     * 一次返回mapper文件中增删改查子tag，在寻找候选tag时需要</span></div><div class="line"><span class="comment">     * <span class="doctag">@return</span> 增删改查子tag列表，每个子tag都包含id属性</span></div><div class="line"><span class="comment">     */</span></div><div class="line">    <span class="meta">@NotNull</span></div><div class="line">    <span class="meta">@SubTagsList</span>(&#123;<span class="string">"insert"</span>, <span class="string">"update"</span>, <span class="string">"delete"</span>, <span class="string">"select"</span>&#125;)</div><div class="line">    <span class="function">List&lt;IdDomElement&gt; <span class="title">getDaoElements</span><span class="params">()</span></span>;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line"><span class="comment">     * mapper标签包含namespace属性</span></div><div class="line"><span class="comment">     */</span></div><div class="line">    <span class="meta">@Required</span></div><div class="line">    <span class="meta">@NameValue</span></div><div class="line">    <span class="meta">@NotNull</span></div><div class="line">    <span class="meta">@Attribute</span>(<span class="string">"namespace"</span>)</div><div class="line">    <span class="function">GenericAttributeValue&lt;String&gt; <span class="title">getNamespace</span><span class="params">()</span></span>;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line"><span class="comment">     * 解析并返回resultMap标签列表</span></div><div class="line"><span class="comment">     */</span></div><div class="line">    <span class="meta">@NotNull</span></div><div class="line">    <span class="meta">@SubTagList</span>(<span class="string">"resultMap"</span>)</div><div class="line">    <span class="function">List&lt;ResultMap&gt; <span class="title">getResultMaps</span><span class="params">()</span></span>;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line"><span class="comment">     * 解析并返回parameterMap标签列表</span></div><div class="line"><span class="comment">     */</span></div><div class="line">    <span class="meta">@NotNull</span></div><div class="line">    <span class="meta">@SubTagList</span>(<span class="string">"parameterMap"</span>)</div><div class="line">    <span class="function">List&lt;ParameterMap&gt; <span class="title">getParameterMaps</span><span class="params">()</span></span>;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line"><span class="comment">     * 解析并返回sql标签列表</span></div><div class="line"><span class="comment">     */</span></div><div class="line">    <span class="meta">@NotNull</span></div><div class="line">    <span class="meta">@SubTagList</span>(<span class="string">"sql"</span>)</div><div class="line">    <span class="function">List&lt;Sql&gt; <span class="title">getSqls</span><span class="params">()</span></span>;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line"><span class="comment">     * 解析并返回insert标签列表</span></div><div class="line"><span class="comment">     */</span></div><div class="line">    <span class="meta">@NotNull</span></div><div class="line">    <span class="meta">@SubTagList</span>(<span class="string">"insert"</span>)</div><div class="line">    <span class="function">List&lt;Insert&gt; <span class="title">getInserts</span><span class="params">()</span></span>;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line"><span class="comment">     * 解析并返回update标签列表</span></div><div class="line"><span class="comment">     */</span></div><div class="line">    <span class="meta">@NotNull</span></div><div class="line">    <span class="meta">@SubTagList</span>(<span class="string">"update"</span>)</div><div class="line">    <span class="function">List&lt;Update&gt; <span class="title">getUpdates</span><span class="params">()</span></span>;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line"><span class="comment">     * 解析并返回delete标签列表</span></div><div class="line"><span class="comment">     */</span></div><div class="line">    <span class="meta">@NotNull</span></div><div class="line">    <span class="meta">@SubTagList</span>(<span class="string">"delete"</span>)</div><div class="line">    <span class="function">List&lt;Delete&gt; <span class="title">getDeletes</span><span class="params">()</span></span>;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line"><span class="comment">     * 解析并返回select标签列表</span></div><div class="line"><span class="comment">     */</span></div><div class="line">    <span class="meta">@NotNull</span></div><div class="line">    <span class="meta">@SubTagList</span>(<span class="string">"select"</span>)</div><div class="line">    <span class="function">List&lt;Select&gt; <span class="title">getSelects</span><span class="params">()</span></span>;</div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>可以看到，每个xml中想解析的标签，都要写一个get方法去标示。<br>这里解释几个常用的注解：</p>
<h4 id="SubTag"><a href="#SubTag" class="headerlink" title="SubTag"></a>SubTag</h4><p><code>@SubTag</code>标注最多出现一次的子标签，对应的get方法返回单个实体。<br>例如<code>resultMap</code>标签中，最多有一个<code>constructor</code>子标签，那么需要写为：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@SubTag</span>(<span class="string">"constructor"</span>)</div><div class="line"><span class="function">Constructor <span class="title">getConstructor</span><span class="params">()</span></span>;</div></pre></td></tr></table></figure></p>
<h4 id="SubTagList"><a href="#SubTagList" class="headerlink" title="SubTagList"></a>SubTagList</h4><p><code>@SubTagList</code>标注可以出现多次的子标签集合，对应的get方法返回实体列表。<br>例如一个<code>mapper</code>标签中，可以有多个<code>resultMap</code>子标签，那么需要写为：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@SubTagList</span>(<span class="string">"resultMap"</span>)</div><div class="line"><span class="function">List&lt;ResultMap&gt; <span class="title">getResultMaps</span><span class="params">()</span></span>;</div></pre></td></tr></table></figure></p>
<h4 id="SubTagsList"><a href="#SubTagsList" class="headerlink" title="SubTagsList"></a>SubTagsList</h4><p><code>@SubTagsList</code>标注的方法，返回多个集合的全集，对应的方法返回实体列表。<br>通常用于返回一个标签中的多个子标签集合。<br>例如，我们要定义一个方法，返回mapper中出现的所有增删改查子标签集合，那么可以写为：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@SubTagsList</span>(&#123;<span class="string">"insert"</span>, <span class="string">"update"</span>, <span class="string">"delete"</span>, <span class="string">"select"</span>&#125;)</div><div class="line"><span class="function">List&lt;IdDomElement&gt; <span class="title">getDaoElements</span><span class="params">()</span></span>;</div></pre></td></tr></table></figure></p>
<h4 id="NameValue"><a href="#NameValue" class="headerlink" title="NameValue"></a>NameValue</h4><p><code>@NameValue</code>的作用：使用这个注解标注<code>Element</code>中的一个方法，这个方法只能返回<code>String</code>或者<code>GenericValue</code>，在使用<code>ElementPresentationManager#getElementName(Object)</code>获取当前<code>Element</code>的名字标示时，返回这个方法的返回值，或者是直接的<code>String</code>，或者是<code>GenericValue</code>，那么返回<code>GenericValue</code>的<code>getStringValue</code>方法结果。</p>
<h4 id="Attribute"><a href="#Attribute" class="headerlink" title="Attribute"></a>Attribute</h4><p><code>@Attribute</code>标注的方法，在xml中是以标签属性的形式出现的，而非标签。例如mapper中的namespace属性。<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">"com.demo.dao.UserDao"</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></div></pre></td></tr></table></figure></p>
<p>那么对应的方法为：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@Attribute</span>(<span class="string">"namespace"</span>)</div><div class="line"><span class="function">GenericAttributeValue&lt;String&gt; <span class="title">getNamespace</span><span class="params">()</span></span>;</div></pre></td></tr></table></figure></p>
<p>上面给出的<code>Mapper</code>接口继承了<code>DomElement</code>接口，这样就成为了一个可以DOM被解析的xml元素。<br><code>Mapper</code>接口中出现的实体也都是需要自己定义的，如<code>ResultMap</code>,<code>Insert</code>等。</p>
<p>下面开始写单个实体，对mapper中的子元素进行解析。</p>
<h4 id="一个包含id属性的基础标签"><a href="#一个包含id属性的基础标签" class="headerlink" title="一个包含id属性的基础标签"></a>一个包含id属性的基础标签</h4><p>很多标签都包含<code>id</code>属性，例如<code>resultMap</code>，<code>insert</code>等，那么我们先定义一个基本标签：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/**</span></div><div class="line"><span class="comment"> * Description:</span></div><div class="line"><span class="comment"> * 定义一个基本dom元素，包含id属性</span></div><div class="line"><span class="comment"> *</span></div><div class="line"><span class="comment"> * <span class="doctag">@author</span> damon4u</span></div><div class="line"><span class="comment"> * <span class="doctag">@version</span> 2018-10-18 15:38</span></div><div class="line"><span class="comment"> */</span></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">IdDomElement</span> <span class="keyword">extends</span> <span class="title">DomElement</span> </span>&#123;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line"><span class="comment">     * 必须包含一个id属性</span></div><div class="line"><span class="comment">     * Required注解标示必须要有该属性</span></div><div class="line"><span class="comment">     * NameValue注解该方法，那么外部获取IdDomElement的标示时，返回该方法的结果</span></div><div class="line"><span class="comment">     * Attribute注解标示xml属性</span></div><div class="line"><span class="comment">     * <span class="doctag">@return</span> 返回GenericAttributeValue而不是String可以方便重命名</span></div><div class="line"><span class="comment">     */</span></div><div class="line">    <span class="meta">@Required</span></div><div class="line">    <span class="meta">@NameValue</span></div><div class="line">    <span class="meta">@Attribute</span>(<span class="string">"id"</span>)</div><div class="line">    <span class="function">GenericAttributeValue&lt;String&gt; <span class="title">getId</span><span class="params">()</span></span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h4 id="动态查询语句元素"><a href="#动态查询语句元素" class="headerlink" title="动态查询语句元素"></a>动态查询语句元素</h4><p>mapper中允许使用<code>where</code>，<code>set</code>，<code>if</code>等动态查询语句拼接查询条件，那么可以抽取出来一个动态查询语句元素：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/**</span></div><div class="line"><span class="comment"> * Description:</span></div><div class="line"><span class="comment"> * mapper中的动态查询语句</span></div><div class="line"><span class="comment"> * http://www.mybatis.org/mybatis-3/dynamic-sql.html</span></div><div class="line"><span class="comment"> *</span></div><div class="line"><span class="comment"> * <span class="doctag">@author</span> damon4u</span></div><div class="line"><span class="comment"> * <span class="doctag">@version</span> 2018-10-18 16:55</span></div><div class="line"><span class="comment"> */</span></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">DynamicQueryableDomElement</span> <span class="keyword">extends</span> <span class="title">DomElement</span> </span>&#123;</div><div class="line"></div><div class="line">    <span class="meta">@NotNull</span></div><div class="line">    <span class="meta">@SubTagList</span>(<span class="string">"include"</span>)</div><div class="line">    <span class="function">List&lt;Include&gt; <span class="title">getIncludes</span><span class="params">()</span></span>;</div><div class="line"></div><div class="line">    <span class="meta">@NotNull</span></div><div class="line">    <span class="meta">@SubTagList</span>(<span class="string">"trim"</span>)</div><div class="line">    <span class="function">List&lt;Trim&gt; <span class="title">getTrims</span><span class="params">()</span></span>;</div><div class="line"></div><div class="line">    <span class="meta">@NotNull</span></div><div class="line">    <span class="meta">@SubTagList</span>(<span class="string">"where"</span>)</div><div class="line">    <span class="function">List&lt;Where&gt; <span class="title">getWheres</span><span class="params">()</span></span>;</div><div class="line"></div><div class="line">    <span class="meta">@NotNull</span></div><div class="line">    <span class="meta">@SubTagList</span>(<span class="string">"set"</span>)</div><div class="line">    <span class="function">List&lt;Set&gt; <span class="title">getSets</span><span class="params">()</span></span>;</div><div class="line"></div><div class="line">    <span class="meta">@NotNull</span></div><div class="line">    <span class="meta">@SubTagList</span>(<span class="string">"foreach"</span>)</div><div class="line">    <span class="function">List&lt;Foreach&gt; <span class="title">getForeachs</span><span class="params">()</span></span>;</div><div class="line"></div><div class="line">    <span class="meta">@NotNull</span></div><div class="line">    <span class="meta">@SubTagList</span>(<span class="string">"choose"</span>)</div><div class="line">    <span class="function">List&lt;Choose&gt; <span class="title">getChooses</span><span class="params">()</span></span>;</div><div class="line"></div><div class="line">    <span class="meta">@NotNull</span></div><div class="line">    <span class="meta">@SubTagList</span>(<span class="string">"if"</span>)</div><div class="line">    <span class="function">List&lt;If&gt; <span class="title">getIfs</span><span class="params">()</span></span>;</div><div class="line"></div><div class="line">    <span class="meta">@SubTagList</span>(<span class="string">"bind"</span>)</div><div class="line">    <span class="function">List&lt;Bind&gt; <span class="title">getBinds</span><span class="params">()</span></span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>其中<code>Trim</code>，<code>Where</code>等子标签又可以包含动态查询语句，因此，可以写为类似递归的形式：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">Where</span> <span class="keyword">extends</span> <span class="title">DynamicQueryableDomElement</span> </span>&#123;</div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>其他子标签与<code>Where</code>类似，不多写。<br>其中<code>Include</code>标签要特殊一些，根据mybatis的规则，该标签用来引用sql代码片段。<br>所谓sql代码片段，是一段可复用的动态查询语句集合，因此我们先定义<code>Sql</code>实体：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">Sql</span> <span class="keyword">extends</span> <span class="title">DynamicQueryableDomElement</span>, <span class="title">IdDomElement</span> </span>&#123;</div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>可以看到它继承了<code>DynamicQueryableDomElement</code>和<code>IdDomElement</code>，代表着它包含了动态查询语句，带有<code>id</code>属性。<br>下面就可以定义<code>include</code>实体了：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">Include</span> <span class="keyword">extends</span> <span class="title">DomElement</span> </span>&#123;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line"><span class="comment">     * include引用标签id</span></div><div class="line"><span class="comment">     * <span class="doctag">@return</span> 引用标签</span></div><div class="line"><span class="comment">     */</span></div><div class="line">    <span class="meta">@Attribute</span>(<span class="string">"refid"</span>)</div><div class="line">    <span class="function">GenericAttributeValue&lt;Sql&gt; <span class="title">getRefId</span><span class="params">()</span></span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>注意返回值泛型参数为<code>Sql</code>实体，这样在xml编写时，IDEA可以自动提供代码补全、鼠标点击跳转引用等功能。</p>
<h4 id="带有请求参数的元素"><a href="#带有请求参数的元素" class="headerlink" title="带有请求参数的元素"></a>带有请求参数的元素</h4><p>增删改查元素都可以配置请求参数，包含<code>parameterType</code>指定一个实体类，那么我们抽取一个元素：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">ParameteredDynamicQueryableDomElement</span> <span class="keyword">extends</span> <span class="title">DynamicQueryableDomElement</span>, <span class="title">IdDomElement</span> </span>&#123;</div><div class="line"></div><div class="line">    <span class="meta">@NotNull</span></div><div class="line">    <span class="meta">@Attribute</span>(<span class="string">"parameterType"</span>)</div><div class="line">    <span class="comment">// <span class="doctag">TODO:</span> converter</span></div><div class="line">    <span class="function">GenericAttributeValue&lt;PsiClass&gt; <span class="title">getParameterType</span><span class="params">()</span></span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>其中<code>parameterType</code>的返回值泛型类型为<code>PsiClass</code>，这样能映射到一个具体的实体类上。</p>
<h4 id="增删改查标签"><a href="#增删改查标签" class="headerlink" title="增删改查标签"></a>增删改查标签</h4><p>有了<code>ParameteredDynamicQueryableDomElement</code>，就可以在此基础上继续丰富，定义增删改查标签。</p>
<h4 id="Insert"><a href="#Insert" class="headerlink" title="Insert"></a>Insert</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">Insert</span> <span class="keyword">extends</span> <span class="title">ParameteredDynamicQueryableDomElement</span> </span>&#123;</div><div class="line"></div><div class="line">    <span class="meta">@SubTagList</span>(<span class="string">"selectKey"</span>)</div><div class="line">    <span class="function">List&lt;SelectKey&gt; <span class="title">getSelectKey</span><span class="params">()</span></span>;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">/**</span></div><div class="line"><span class="comment"> * Description:</span></div><div class="line"><span class="comment"> * 插入语句中的selectkey标签，用来生成主键</span></div><div class="line"><span class="comment"> *</span></div><div class="line"><span class="comment"> * <span class="doctag">@author</span> damon4u</span></div><div class="line"><span class="comment"> * <span class="doctag">@version</span> 2018-10-18 17:32</span></div><div class="line"><span class="comment"> */</span></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">SelectKey</span> <span class="keyword">extends</span> <span class="title">DomElement</span> </span>&#123;</div><div class="line"></div><div class="line">    <span class="meta">@NotNull</span></div><div class="line">    <span class="meta">@Attribute</span>(<span class="string">"resultType"</span>)</div><div class="line">    <span class="comment">// <span class="doctag">TODO:</span> converter</span></div><div class="line">    <span class="function">GenericAttributeValue&lt;PsiClass&gt; <span class="title">getResultType</span><span class="params">()</span></span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h4 id="Delete"><a href="#Delete" class="headerlink" title="Delete"></a>Delete</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">Delete</span> <span class="keyword">extends</span> <span class="title">ParameteredDynamicQueryableDomElement</span> </span>&#123;</div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h4 id="Update"><a href="#Update" class="headerlink" title="Update"></a>Update</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">Update</span> <span class="keyword">extends</span> <span class="title">ParameteredDynamicQueryableDomElement</span> </span>&#123;</div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h4 id="Select"><a href="#Select" class="headerlink" title="Select"></a>Select</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">Select</span> <span class="keyword">extends</span> <span class="title">ParameteredDynamicQueryableDomElement</span>, <span class="title">ResultMapAttributeDomElement</span> </span>&#123;</div><div class="line"></div><div class="line">    <span class="meta">@NotNull</span></div><div class="line">    <span class="meta">@Attribute</span>(<span class="string">"resultType"</span>)</div><div class="line">    <span class="comment">// <span class="doctag">TODO:</span> converter</span></div><div class="line">    <span class="function">GenericAttributeValue&lt;PsiClass&gt; <span class="title">getResultType</span><span class="params">()</span></span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>其中返回<code>resultType</code>好理解，指定一个实体类，而mybatis规定select标签是可以返回<code>resultMap</code>的。<br>这里提现在<code>ResultMapAttributeDomElement</code>：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">ResultMapAttributeDomElement</span> <span class="keyword">extends</span> <span class="title">DomElement</span> </span>&#123;</div><div class="line"></div><div class="line">    <span class="meta">@NotNull</span></div><div class="line">    <span class="meta">@Attribute</span>(<span class="string">"resultMap"</span>)</div><div class="line">    <span class="comment">// <span class="doctag">TODO:</span> converter</span></div><div class="line">    <span class="function">GenericAttributeValue&lt;ResultMap&gt; <span class="title">getResultMap</span><span class="params">()</span></span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>接下来重点介绍这个相对复杂的<code>resultMap</code>。</p>
<h4 id="resultMap"><a href="#resultMap" class="headerlink" title="resultMap"></a>resultMap</h4><p><code>resultMap</code>元素有很多子元素和一个值得讨论的结构。</p>
<ul>
<li><code>constructor</code> - 用于在实例化类时，注入结果到构造方法中<ul>
<li><code>idArg</code> - ID 参数;标记出作为 ID 的结果可以帮助提高整体性能</li>
<li><code>arg</code> - 将被注入到构造方法的一个普通结果</li>
</ul>
</li>
<li><code>id</code> – 一个 ID 结果;标记出作为 ID 的结果可以帮助提高整体性能</li>
<li><code>result</code> – 注入到字段或<code>JavaBean</code>属性的普通结果</li>
<li><code>association</code> – 一个复杂类型的关联;许多结果将包装成这种类型<ul>
<li>嵌套结果映射 – associations are resultMaps themselves, or can refer to one</li>
</ul>
</li>
<li><code>collection</code> – 一个复杂类型的集合<ul>
<li>嵌套结果映射 – collections are resultMaps themselves, or can refer to one</li>
</ul>
</li>
<li><code>discriminator</code> – 使用结果值来决定使用哪个<code>resultMap</code><ul>
<li><code>case</code> – 基于某些值的结果映射<ul>
<li>嵌套结果映射 – 一个 case 也是一个映射它本身的结果,因此可以包含很多相 同的元素，或者它可以参照一个外部的 resultMap。</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>首先，将<code>resultMap</code>中的基础元素抽取出来，他们可能直接出现在<code>resultMap</code>标签中，也可能出现在<code>association</code>等子标签中：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/**</span></div><div class="line"><span class="comment"> * Description:</span></div><div class="line"><span class="comment"> * mapper中的resultMap标签内元素基本属性</span></div><div class="line"><span class="comment"> *</span></div><div class="line"><span class="comment"> * <span class="doctag">@author</span> damon4u</span></div><div class="line"><span class="comment"> * <span class="doctag">@version</span> 2018-10-18 17:47</span></div><div class="line"><span class="comment"> */</span></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">ResultMapBaseDomElement</span> <span class="keyword">extends</span> <span class="title">DomElement</span> </span>&#123;</div><div class="line"></div><div class="line">    <span class="meta">@SubTag</span>(<span class="string">"constructor"</span>)</div><div class="line">    <span class="function">Constructor <span class="title">getConstructor</span><span class="params">()</span></span>;</div><div class="line"></div><div class="line">    <span class="meta">@SubTagList</span>(<span class="string">"id"</span>)</div><div class="line">    <span class="function">List&lt;Id&gt; <span class="title">getIds</span><span class="params">()</span></span>;</div><div class="line"></div><div class="line">    <span class="meta">@SubTagList</span>(<span class="string">"result"</span>)</div><div class="line">    <span class="function">List&lt;Result&gt; <span class="title">getResults</span><span class="params">()</span></span>;</div><div class="line"></div><div class="line">    <span class="meta">@SubTagList</span>(<span class="string">"association"</span>)</div><div class="line">    <span class="function">List&lt;Association&gt; <span class="title">getAssociations</span><span class="params">()</span></span>;</div><div class="line"></div><div class="line">    <span class="meta">@SubTagList</span>(<span class="string">"collection"</span>)</div><div class="line">    <span class="function">List&lt;Collection&gt; <span class="title">getCollections</span><span class="params">()</span></span>;</div><div class="line"></div><div class="line">    <span class="meta">@SubTag</span>(<span class="string">"discriminator"</span>)</div><div class="line">    <span class="function">Discriminator <span class="title">getDiscriminator</span><span class="params">()</span></span>;</div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>其中<code>id</code>和<code>result</code>子标签功能类似，用来做数据库字段与实体字段映射，包含<code>property</code>属性，那么我们将<code>property</code>属性抽取出来：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/**</span></div><div class="line"><span class="comment"> * Description:</span></div><div class="line"><span class="comment"> * 包含property属性的元素</span></div><div class="line"><span class="comment"> *</span></div><div class="line"><span class="comment"> * <span class="doctag">@author</span> damon4u</span></div><div class="line"><span class="comment"> * <span class="doctag">@version</span> 2018-10-18 17:52</span></div><div class="line"><span class="comment"> */</span></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">PropertyAttributeDomElement</span> <span class="keyword">extends</span> <span class="title">DomElement</span> </span>&#123;</div><div class="line"></div><div class="line">    <span class="meta">@Attribute</span>(<span class="string">"property"</span>)</div><div class="line">    <span class="meta">@Convert</span>(PropertyConverter.class)</div><div class="line">    <span class="function">GenericAttributeValue&lt;XmlAttributeValue&gt; <span class="title">getProperty</span><span class="params">()</span></span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>然后让<code>id</code>和<code>result</code>去继承它：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">Id</span> <span class="keyword">extends</span> <span class="title">PropertyAttributeDomElement</span> </span>&#123;</div><div class="line"></div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">Result</span> <span class="keyword">extends</span> <span class="title">PropertyAttributeDomElement</span> </span>&#123;</div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>而<code>association</code>和<code>collection</code>子标签功能会多一些，内部还可能包含一个嵌套的<code>resultMap</code>，因此会继承多一些，当然，它们会包含自己独有的属性：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">Association</span> <span class="keyword">extends</span> <span class="title">ResultMapBaseDomElement</span>, <span class="title">ResultMapAttributeDomElement</span>, <span class="title">PropertyAttributeDomElement</span> </span>&#123;</div><div class="line"></div><div class="line">    <span class="meta">@NotNull</span></div><div class="line">    <span class="meta">@Attribute</span>(<span class="string">"javaType"</span>)</div><div class="line">    <span class="comment">// <span class="doctag">TODO:</span> converter</span></div><div class="line">    <span class="function">GenericAttributeValue&lt;PsiClass&gt; <span class="title">getJavaType</span><span class="params">()</span></span>;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">Collection</span> <span class="keyword">extends</span> <span class="title">ResultMapBaseDomElement</span>, <span class="title">ResultMapAttributeDomElement</span>, <span class="title">PropertyAttributeDomElement</span> </span>&#123;</div><div class="line"></div><div class="line">    <span class="meta">@NotNull</span></div><div class="line">    <span class="meta">@Attribute</span>(<span class="string">"ofType"</span>)</div><div class="line">    <span class="comment">// <span class="doctag">TODO:</span> converter</span></div><div class="line">    <span class="function">GenericAttributeValue&lt;PsiClass&gt; <span class="title">getOfType</span><span class="params">()</span></span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h4 id="属性转换器PropertyConverter"><a href="#属性转换器PropertyConverter" class="headerlink" title="属性转换器PropertyConverter"></a>属性转换器PropertyConverter</h4><blockquote>
<p>注：属性转换器涉及到 <strong>PSI Reference</strong> 的知识，在下一篇文章中做介绍。</p>
</blockquote>
<p>重新把<code>property</code>属性请回来，因为我们要讲它的转换器：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/**</span></div><div class="line"><span class="comment"> * Description:</span></div><div class="line"><span class="comment"> * 包含property属性的元素</span></div><div class="line"><span class="comment"> *</span></div><div class="line"><span class="comment"> * <span class="doctag">@author</span> damon4u</span></div><div class="line"><span class="comment"> * <span class="doctag">@version</span> 2018-10-18 17:52</span></div><div class="line"><span class="comment"> */</span></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">PropertyAttributeDomElement</span> <span class="keyword">extends</span> <span class="title">DomElement</span> </span>&#123;</div><div class="line"></div><div class="line">    <span class="meta">@Attribute</span>(<span class="string">"property"</span>)</div><div class="line">    <span class="meta">@Convert</span>(PropertyConverter.class)</div><div class="line">    <span class="function">GenericAttributeValue&lt;XmlAttributeValue&gt; <span class="title">getProperty</span><span class="params">()</span></span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>首先说目的，加这个转换器，是为了让<code>resultMap</code>中的<code>property</code>属性具有鼠标点击跳转操作，即为属性值创建引用到实体上。<br>假如我们有这样一个<code>User</code>实体：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">User</span> </span>&#123;</div><div class="line"></div><div class="line">    <span class="keyword">private</span> Long id;</div><div class="line"></div><div class="line">    <span class="keyword">private</span> String userName;</div><div class="line"></div><div class="line">    <span class="keyword">private</span> Integer age;</div><div class="line"></div><div class="line">    <span class="keyword">private</span> User son;</div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>我们可能会有如下<code>resultMap</code>：<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">id</span>=<span class="string">"userResultMap"</span> <span class="attr">type</span>=<span class="string">"com.damon4u.demo.domain.User"</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">id</span> <span class="attr">column</span>=<span class="string">"id"</span> <span class="attr">property</span>=<span class="string">"id"</span>/&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">"user_name"</span> <span class="attr">property</span>=<span class="string">"userName"</span>/&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">"age"</span> <span class="attr">property</span>=<span class="string">"age"</span>/&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">"son_id"</span> <span class="attr">property</span>=<span class="string">"son.id"</span>/&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></div></pre></td></tr></table></figure></p>
<p>按照mybatis规定，除了可以映射基本类型和简单类型，还可以映射带引用嵌套层级的属性，如<code>son.id</code>。</p>
<p>首先创建个<code>MapperUtils</code>，写一个方法，用来获取当前<code>property</code>所属标签对应哪个实体类：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">MapperUtils</span> </span>&#123;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">private</span> <span class="title">MapperUtils</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> UnsupportedOperationException();</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line"><span class="comment">     * 获取property从属的类型</span></div><div class="line"><span class="comment">     *</span></div><div class="line"><span class="comment">     * <span class="doctag">@param</span> attributeValue property属性</span></div><div class="line"><span class="comment">     * <span class="doctag">@return</span></span></div><div class="line"><span class="comment">     */</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Optional&lt;PsiClass&gt; <span class="title">getPropertyClazz</span><span class="params">(XmlAttributeValue attributeValue)</span> </span>&#123;</div><div class="line">        DomElement domElement = DomUtil.getDomElement(attributeValue);</div><div class="line">        <span class="keyword">if</span> (<span class="keyword">null</span> == domElement) &#123;</div><div class="line">            <span class="keyword">return</span> Optional.empty();</div><div class="line">        &#125;</div><div class="line">        <span class="comment">// collection标签下的property，那么类型为ofType指定</span></div><div class="line">        Collection collection = DomUtil.getParentOfType(domElement, Collection.class, <span class="keyword">true</span>);</div><div class="line">        <span class="keyword">if</span> (<span class="keyword">null</span> != collection &amp;&amp; isNotWithinSameTag(collection, attributeValue)) &#123;</div><div class="line">            <span class="keyword">return</span> Optional.ofNullable(collection.getOfType().getValue());</div><div class="line">        &#125;</div><div class="line">        <span class="comment">// association标签下的property，那么类型为javaType指定</span></div><div class="line">        Association association = DomUtil.getParentOfType(domElement, Association.class, <span class="keyword">true</span>);</div><div class="line">        <span class="keyword">if</span> (<span class="keyword">null</span> != association &amp;&amp; isNotWithinSameTag(association, attributeValue)) &#123;</div><div class="line">            <span class="keyword">return</span> Optional.ofNullable(association.getJavaType().getValue());</div><div class="line">        &#125;</div><div class="line">        <span class="comment">// resultMap标签下的property，那么类型为type指定</span></div><div class="line">        ResultMap resultMap = DomUtil.getParentOfType(domElement, ResultMap.class, <span class="keyword">true</span>);</div><div class="line">        <span class="keyword">if</span> (<span class="keyword">null</span> != resultMap &amp;&amp; isNotWithinSameTag(resultMap, attributeValue)) &#123;</div><div class="line">            <span class="keyword">return</span> Optional.ofNullable(resultMap.getType().getValue());</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">return</span> Optional.empty();</div><div class="line"></div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">boolean</span> <span class="title">isNotWithinSameTag</span><span class="params">(@NotNull DomElement domElement, @NotNull XmlElement xmlElement)</span> </span>&#123;</div><div class="line">        XmlTag xmlTag = PsiTreeUtil.getParentOfType(xmlElement, XmlTag.class);</div><div class="line">        <span class="keyword">return</span> !domElement.getXmlTag().equals(xmlTag);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>接下来还需要一个工具类<code>JavaUtils</code>，用来从类中寻找成员变量（非static、非final）的：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">JavaUtils</span> </span>&#123;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">private</span> <span class="title">JavaUtils</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> UnsupportedOperationException();</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line"><span class="comment">     * 从类中查找成员变量</span></div><div class="line"><span class="comment">     *</span></div><div class="line"><span class="comment">     * <span class="doctag">@param</span> clazz        类</span></div><div class="line"><span class="comment">     * <span class="doctag">@param</span> propertyName 属性名称</span></div><div class="line"><span class="comment">     * <span class="doctag">@return</span></span></div><div class="line"><span class="comment">     */</span></div><div class="line">    <span class="meta">@NotNull</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Optional&lt;PsiField&gt; <span class="title">findSettablePsiField</span><span class="params">(@NotNull <span class="keyword">final</span> PsiClass clazz,</span></span></div><div class="line"><span class="function"><span class="params">                                                          @Nullable <span class="keyword">final</span> String propertyName)</span> </span>&#123;</div><div class="line">        <span class="keyword">final</span> PsiField field = PropertyUtil.findPropertyField(clazz, propertyName, <span class="keyword">false</span>);</div><div class="line">        <span class="keyword">return</span> Optional.ofNullable(field);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line"><span class="comment">     * 获取类中所有成员变量</span></div><div class="line"><span class="comment">     *</span></div><div class="line"><span class="comment">     * <span class="doctag">@param</span> clazz 类</span></div><div class="line"><span class="comment">     * <span class="doctag">@return</span></span></div><div class="line"><span class="comment">     */</span></div><div class="line">    <span class="meta">@NotNull</span></div><div class="line">    <span class="keyword">public</span> <span class="keyword">static</span> PsiField[] findSettablePsiFields(<span class="keyword">final</span> <span class="meta">@NotNull</span> PsiClass clazz) &#123;</div><div class="line">        <span class="keyword">final</span> PsiField[] allFields = clazz.getAllFields();</div><div class="line">        <span class="keyword">final</span> List&lt;PsiField&gt; settableFields = <span class="keyword">new</span> ArrayList&lt;&gt;(allFields.length);</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">final</span> PsiField field : allFields) &#123;</div><div class="line">            <span class="keyword">final</span> PsiModifierList modifierList = field.getModifierList();</div><div class="line">            <span class="keyword">if</span> (modifierList != <span class="keyword">null</span> &amp;&amp;</div><div class="line">                    (modifierList.hasModifierProperty(PsiModifier.STATIC)</div><div class="line">                            || modifierList.hasModifierProperty(PsiModifier.FINAL))) &#123;</div><div class="line">                <span class="keyword">continue</span>;</div><div class="line">            &#125;</div><div class="line">            settableFields.add(field);</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">return</span> settableFields.toArray(<span class="keyword">new</span> PsiField[<span class="number">0</span>]);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>有了工具类，就可以写解析器了，将xml属性解析到实体类字段：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/**</span></div><div class="line"><span class="comment"> * Description:</span></div><div class="line"><span class="comment"> * &lt;p&gt;</span></div><div class="line"><span class="comment"> * 将xml属性解析到实体类字段</span></div><div class="line"><span class="comment"> *</span></div><div class="line"><span class="comment"> * <span class="doctag">@author</span> damon4u</span></div><div class="line"><span class="comment"> * <span class="doctag">@version</span> 2018-10-19 11:46</span></div><div class="line"><span class="comment"> */</span></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">PsiFiledReferenceSetResolver</span> </span>&#123;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line"><span class="comment">     * 嵌套引用分隔符</span></div><div class="line"><span class="comment">     */</span></div><div class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> Splitter SPLITTER = Splitter.on(String.valueOf(ReferenceSetBase.DOT_SEPARATOR));</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line"><span class="comment">     * 当前属性元素</span></div><div class="line"><span class="comment">     */</span></div><div class="line">    <span class="keyword">private</span> XmlAttributeValue element;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line"><span class="comment">     * 属性全名可能包含引用，例如user.name，那么按照点号分割，保存所有字段名称</span></div><div class="line"><span class="comment">     */</span></div><div class="line">    <span class="keyword">private</span> List&lt;String&gt; fieldNameWithReferenceList;</div><div class="line"></div><div class="line">    PsiFiledReferenceSetResolver(<span class="meta">@NotNull</span> XmlAttributeValue element) &#123;</div><div class="line">        <span class="keyword">this</span>.element = element;</div><div class="line">        <span class="comment">// 属性全名，可能包含引用，如user.name</span></div><div class="line">        String wholeFiledName = element.getValue() != <span class="keyword">null</span> ? element.getValue() : <span class="string">""</span>;</div><div class="line">        <span class="keyword">this</span>.fieldNameWithReferenceList = Lists.newArrayList(SPLITTER.split(wholeFiledName));</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line"><span class="comment">     * 将xml属性解析到实体类字段</span></div><div class="line"><span class="comment">     *</span></div><div class="line"><span class="comment">     * <span class="doctag">@param</span> index 按照点号分割后，属性位于哪一级，index为索引值</span></div><div class="line"><span class="comment">     *              例如user.name，那么idea会为user和name分别创建引用，都可以鼠标点击跳转</span></div><div class="line"><span class="comment">     *              user的index为0，name的index为1</span></div><div class="line"><span class="comment">     *              这个值决定解析层级深度</span></div><div class="line"><span class="comment">     */</span></div><div class="line">    <span class="keyword">final</span> Optional&lt;? extends PsiElement&gt; resolve(<span class="keyword">int</span> index) &#123;</div><div class="line">        <span class="comment">// 先获取一级属性</span></div><div class="line">        <span class="comment">// 对于简单属性"name"，那么就是这个属性</span></div><div class="line">        <span class="comment">// 对于包含引用的情况"user.name"，那么先找到一级属性user</span></div><div class="line">        Optional&lt;PsiField&gt; firstLevelElement = getFirstLevelElement(Iterables.getFirst(fieldNameWithReferenceList, <span class="keyword">null</span>));</div><div class="line">        <span class="keyword">return</span> firstLevelElement.isPresent() ?</div><div class="line">                (fieldNameWithReferenceList.size() &gt; <span class="number">1</span> ? parseNextLevelElement(firstLevelElement, index) : firstLevelElement)</div><div class="line">                : Optional.empty();</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line"><span class="comment">     * 获取一级属性</span></div><div class="line"><span class="comment">     * 对于简单属性"name"，那么就是这个属性</span></div><div class="line"><span class="comment">     * 对于包含引用的情况"user.name"，那么先找到一级属性user</span></div><div class="line"><span class="comment">     *</span></div><div class="line"><span class="comment">     * <span class="doctag">@param</span> firstLevelFieldName 第一层级的属性名，可能是一个引用，也可能是基本类型</span></div><div class="line"><span class="comment">     * <span class="doctag">@return</span></span></div><div class="line"><span class="comment">     */</span></div><div class="line">    <span class="meta">@NotNull</span></div><div class="line">    <span class="function"><span class="keyword">private</span> Optional&lt;PsiField&gt; <span class="title">getFirstLevelElement</span><span class="params">(@Nullable String firstLevelFieldName)</span> </span>&#123;</div><div class="line">        Optional&lt;PsiClass&gt; clazz = MapperUtils.getPropertyClazz(element);</div><div class="line">        <span class="keyword">return</span> clazz.flatMap(psiClass -&gt; JavaUtils.findSettablePsiField(psiClass, firstLevelFieldName));</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line"><span class="comment">     * 按照点号逐层解析，前面层级为引用，去引用中解析下一层字段</span></div><div class="line"><span class="comment">     *</span></div><div class="line"><span class="comment">     * <span class="doctag">@param</span> maxLevelIndex 最大解析层级深度，比如"user.name"，那么如果是要为user建立引用，maxLevelIndex为1；</span></div><div class="line"><span class="comment">     *                      如果要为name建立引用，那么maxLevelIndex为2</span></div><div class="line"><span class="comment">     */</span></div><div class="line">    <span class="function"><span class="keyword">private</span> Optional&lt;PsiField&gt; <span class="title">parseNextLevelElement</span><span class="params">(Optional&lt;PsiField&gt; current, <span class="keyword">int</span> maxLevelIndex)</span> </span>&#123;</div><div class="line">        <span class="keyword">int</span> index = <span class="number">1</span>;</div><div class="line">        <span class="keyword">while</span> (current.isPresent() &amp;&amp; index &lt;= maxLevelIndex) &#123;</div><div class="line">            String nextLevelIndexFiledName = fieldNameWithReferenceList.get(index);</div><div class="line">            <span class="keyword">if</span> (nextLevelIndexFiledName.contains(<span class="string">" "</span>)) &#123;</div><div class="line">                <span class="keyword">return</span> Optional.empty();</div><div class="line">            &#125;</div><div class="line">            current = resolveReferenceField(current.get(), nextLevelIndexFiledName);</div><div class="line">            index++;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">return</span> current;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line"><span class="comment">     * 从引用类型中解析字段</span></div><div class="line"><span class="comment">     * 例如user.name</span></div><div class="line"><span class="comment">     * 那么current为前面解析出来的user引用，fieldName为name</span></div><div class="line"><span class="comment">     *</span></div><div class="line"><span class="comment">     * <span class="doctag">@param</span> current   当前引用</span></div><div class="line"><span class="comment">     * <span class="doctag">@param</span> fieldName 要从引用中解析的字段名称</span></div><div class="line"><span class="comment">     * <span class="doctag">@return</span> 字段</span></div><div class="line"><span class="comment">     */</span></div><div class="line">    <span class="meta">@NotNull</span></div><div class="line">    <span class="function"><span class="keyword">private</span> Optional&lt;PsiField&gt; <span class="title">resolveReferenceField</span><span class="params">(@NotNull PsiField current, @NotNull String fieldName)</span> </span>&#123;</div><div class="line">        PsiType type = current.getType();</div><div class="line">        <span class="comment">// 引用类型，而且不包含可变参数</span></div><div class="line">        <span class="keyword">if</span> (type <span class="keyword">instanceof</span> PsiClassReferenceType &amp;&amp; !((PsiClassReferenceType) type).hasParameters()) &#123;</div><div class="line">            PsiClass clazz = ((PsiClassReferenceType) type).resolve();</div><div class="line">            <span class="keyword">if</span> (<span class="keyword">null</span> != clazz) &#123;</div><div class="line">                <span class="keyword">return</span> JavaUtils.findSettablePsiField(clazz, fieldName);</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">return</span> Optional.empty();</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>外部调用<code>resolve</code>方法，首先对一级属性进行解析，如果包含了嵌套引用，那么需要逐层解析。</p>
<p>有了解析器，就可以创建一个<code>PsiReference</code>引用，顾名思义，就是创建一个Psi元素的引用：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ContextPsiFieldReference</span> <span class="keyword">extends</span> <span class="title">PsiReferenceBase</span>&lt;<span class="title">XmlAttributeValue</span>&gt; </span>&#123;</div><div class="line"></div><div class="line">    <span class="keyword">private</span> PsiFiledReferenceSetResolver resolver;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line"><span class="comment">     * 当前解析层级</span></div><div class="line"><span class="comment">     * 例如property为"user.name"</span></div><div class="line"><span class="comment">     * 那么如果鼠标点击的user，index为1</span></div><div class="line"><span class="comment">     * 如果鼠标点击的是name，index为2</span></div><div class="line"><span class="comment">     */</span></div><div class="line">    <span class="keyword">private</span> <span class="keyword">int</span> index;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line"><span class="comment">     * <span class="doctag">@param</span> element 当前元素</span></div><div class="line"><span class="comment">     * <span class="doctag">@param</span> range   元素边界</span></div><div class="line"><span class="comment">     * <span class="doctag">@param</span> index   引用层级</span></div><div class="line"><span class="comment">     */</span></div><div class="line">    ContextPsiFieldReference(XmlAttributeValue element, TextRange range, <span class="keyword">int</span> index) &#123;</div><div class="line">        <span class="keyword">super</span>(element, range, <span class="keyword">false</span>);</div><div class="line">        <span class="keyword">this</span>.index = index;</div><div class="line">        resolver = <span class="keyword">new</span> PsiFiledReferenceSetResolver(element);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line"><span class="comment">     * 解析xml属性，返回对应的引用变量</span></div><div class="line"><span class="comment">     */</span></div><div class="line">    <span class="meta">@SuppressWarnings</span>(<span class="string">"unchecked"</span>)</div><div class="line">    <span class="meta">@Nullable</span></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> PsiElement <span class="title">resolve</span><span class="params">()</span> </span>&#123;</div><div class="line">        Optional&lt;PsiElement&gt; resolved = (Optional&lt;PsiElement&gt;) resolver.resolve(index);</div><div class="line">        <span class="keyword">return</span> resolved.orElse(<span class="keyword">null</span>);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line"><span class="comment">     * 代码自动提示类型中所有可赋值（非static和非final）的成员变量列表</span></div><div class="line"><span class="comment">     *</span></div><div class="line"><span class="comment">     * <span class="doctag">@return</span> 类型中所有可赋值（非static和非final）的成员变量列表</span></div><div class="line"><span class="comment">     */</span></div><div class="line">    <span class="meta">@NotNull</span></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="keyword">public</span> Object[] getVariants() &#123;</div><div class="line">        Optional&lt;PsiClass&gt; clazz = getTargetClazz();</div><div class="line">        <span class="keyword">return</span> clazz.isPresent() ? JavaUtils.findSettablePsiFields(clazz.get()) : PsiReference.EMPTY_ARRAY;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line"><span class="comment">     * 获取property参数的类型</span></div><div class="line"><span class="comment">     * 如果是简单的"name"，那么就使用外层标签指定的类型</span></div><div class="line"><span class="comment">     * 如果是带引用的"user.name"，那么需要深入解析出具体引用类型user</span></div><div class="line"><span class="comment">     *</span></div><div class="line"><span class="comment">     * <span class="doctag">@return</span> property参数的类型</span></div><div class="line"><span class="comment">     */</span></div><div class="line">    <span class="meta">@SuppressWarnings</span>(<span class="string">"unchecked"</span>)</div><div class="line">    <span class="function"><span class="keyword">private</span> Optional&lt;PsiClass&gt; <span class="title">getTargetClazz</span><span class="params">()</span> </span>&#123;</div><div class="line">        String elementValue = getElement().getValue();</div><div class="line">        <span class="keyword">if</span> (elementValue == <span class="keyword">null</span>) &#123;</div><div class="line">            <span class="keyword">return</span> Optional.empty();</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">if</span> (elementValue.contains(String.valueOf(ReferenceSetBase.DOT_SEPARATOR))) &#123;</div><div class="line">            <span class="comment">// 包含点号，说明此参数的类型为引用类型</span></div><div class="line">            <span class="comment">// 例如一个类的成员变量中包含其他引用类型</span></div><div class="line">            <span class="keyword">int</span> ind = <span class="number">0</span> == index ? <span class="number">0</span> : index - <span class="number">1</span>;</div><div class="line">            Optional&lt;PsiElement&gt; resolved = (Optional&lt;PsiElement&gt;) resolver.resolve(ind);</div><div class="line">            <span class="keyword">if</span> (resolved.isPresent()) &#123;</div><div class="line">                <span class="keyword">return</span> JavaService.getInstance(myElement.getProject()).getReferenceClazzOfPsiField(resolved.get());</div><div class="line">            &#125;</div><div class="line">        &#125; <span class="keyword">else</span> &#123; <span class="comment">// 没有点号，说明参数类型不是引用类型，直接就是外层标签定义的类型（如resultMap中type指定的类型）中包含的简单类型，如基本类型或者字符串类型变量</span></div><div class="line">            <span class="keyword">return</span> MapperUtils.getPropertyClazz(myElement);</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">return</span> Optional.empty();</div><div class="line">    &#125;</div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>上面创建的<code>ContextPsiFieldReference</code>引用需要传入<code>index</code>变量，用来指出引用的层级。<br>例如xml中属性值为<code>user.name</code>，那么如果是<code>user</code>这一层的引用，<code>index</code>为1，如果是<code>name</code>这一层的引用，<code>index</code>为2。</p>
<p>接下来创建一个<code>ReferenceSetBase</code>，用来解析嵌套引用。<br>继承<code>ReferenceSetBase</code>并重写<code>createReference</code>方法，使用我们上面创建的<code>ContextPsiFieldReference</code>。基类<code>ReferenceSetBase</code>中包含着对嵌套引用的解析操作：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ResultPropertyReferenceSet</span> <span class="keyword">extends</span> <span class="title">ReferenceSetBase</span>&lt;<span class="title">PsiReference</span>&gt; </span>&#123;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="title">ResultPropertyReferenceSet</span><span class="params">(String text, @NotNull PsiElement element, <span class="keyword">int</span> offset)</span> </span>&#123;</div><div class="line">        <span class="keyword">super</span>(text, element, offset, ReferenceSetBase.DOT_SEPARATOR);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">protected</span> PsiReference <span class="title">createReference</span><span class="params">(TextRange range, <span class="keyword">int</span> index)</span> </span>&#123;</div><div class="line">        XmlAttributeValue element = (XmlAttributeValue) getElement();</div><div class="line">        <span class="keyword">return</span> <span class="keyword">null</span> == element ? <span class="keyword">null</span> : <span class="keyword">new</span> ContextPsiFieldReference(element, range, index);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>有了引用，接下来需要放到转换器中，与字段绑定：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">PropertyConverter</span> <span class="keyword">extends</span> <span class="title">ResolvingConverter</span>&lt;<span class="title">XmlAttributeValue</span>&gt; <span class="keyword">implements</span> <span class="title">CustomReferenceConverter</span>&lt;<span class="title">XmlAttributeValue</span>&gt; </span>&#123;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line"><span class="comment">     * converter实现CustomReferenceConverter，这样能通过实现createReferences创建引用关系</span></div><div class="line"><span class="comment">     * <span class="doctag">@param</span> value</span></div><div class="line"><span class="comment">     * <span class="doctag">@param</span> element</span></div><div class="line"><span class="comment">     * <span class="doctag">@param</span> context</span></div><div class="line"><span class="comment">     * <span class="doctag">@return</span></span></div><div class="line"><span class="comment">     */</span></div><div class="line">    <span class="meta">@NotNull</span></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="keyword">public</span> PsiReference[] createReferences(GenericDomValue&lt;XmlAttributeValue&gt; value, PsiElement element, ConvertContext context) &#123;</div><div class="line">        String stringValue = value.getStringValue();</div><div class="line">        <span class="keyword">if</span> (stringValue == <span class="keyword">null</span>) &#123;</div><div class="line">            <span class="keyword">return</span> PsiReference.EMPTY_ARRAY;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">return</span> <span class="keyword">new</span> ResultPropertyReferenceSet(stringValue, element, ElementManipulators.getOffsetInElement(element)).getPsiReferences();</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@NotNull</span></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="keyword">public</span> Collection&lt;? extends XmlAttributeValue&gt; getVariants(ConvertContext context) &#123;</div><div class="line">        <span class="keyword">return</span> Collections.emptyList();</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Nullable</span></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> XmlAttributeValue <span class="title">fromString</span><span class="params">(@Nullable String s, ConvertContext context)</span> </span>&#123;</div><div class="line">        DomElement ctxElement = context.getInvocationElement();</div><div class="line">        <span class="keyword">return</span> ctxElement <span class="keyword">instanceof</span> GenericAttributeValue ? ((GenericAttributeValue) ctxElement).getXmlAttributeValue() : <span class="keyword">null</span>;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Nullable</span></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">(@Nullable XmlAttributeValue attributeValue, ConvertContext context)</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>最后再看一次使用方式：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/**</span></div><div class="line"><span class="comment"> * Description:</span></div><div class="line"><span class="comment"> * 包含property属性的元素</span></div><div class="line"><span class="comment"> *</span></div><div class="line"><span class="comment"> * <span class="doctag">@author</span> damon4u</span></div><div class="line"><span class="comment"> * <span class="doctag">@version</span> 2018-10-18 17:52</span></div><div class="line"><span class="comment"> */</span></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">PropertyAttributeDomElement</span> <span class="keyword">extends</span> <span class="title">DomElement</span> </span>&#123;</div><div class="line"></div><div class="line">    <span class="meta">@Attribute</span>(<span class="string">"property"</span>)</div><div class="line">    <span class="meta">@Convert</span>(PropertyConverter.class)</div><div class="line">    <span class="function">GenericAttributeValue&lt;XmlAttributeValue&gt; <span class="title">getProperty</span><span class="params">()</span></span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>这样，再DOM解析时，会使用该converter，而converter实现了<code>CustomReferenceConverter</code>，可以创建引用，就能实现引用绑定了。</p>
<p>参考：<br><a href="https://www.jetbrains.org/intellij/sdk/docs/basics/architectural_overview/psi_references.html" target="_blank" rel="external">PSI References</a><br><a href="https://www.jetbrains.org/intellij/sdk/docs/reference_guide/custom_language_support/references_and_resolve.html" target="_blank" rel="external">References and Resolve</a><br><a href="https://www.jetbrains.org/intellij/sdk/docs/tutorials/custom_language_support/reference_contributor.html" target="_blank" rel="external">Reference Contributor</a></p>

      
    </div>

    <div>
      
        

      
    </div>
  
        <div class="post-tags">
          
            <a href="/tags/idea/" rel="tag"><i class="fa fa-tag"></i> idea</a>
          
        </div>
      


    <footer class="post-footer">

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/blog/2018/10/对称加密与AES算法.html" rel="next" title="对称加密与AES算法">
                <i class="fa fa-chevron-left"></i> 对称加密与AES算法
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/blog/2018/10/Charles抓取HTTPS接口.html" rel="prev" title="Charles抓取HTTPS接口">
                Charles抓取HTTPS接口 <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </article>



    <div class="post-spread">
      
    </div>
  </div>

          
          </div>
          
  <div class="comments" id="comments">
    
  </div>


        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap" >
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview">
            站点概览
          </li>
        </ul>
      

      <section class="site-overview sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="/images/avatar2.jpg"
               alt="五月y" />
          <p class="site-author-name" itemprop="name">五月y</p>
          <p class="site-description motion-element" itemprop="description">Hello 五月y!</p>
        </div>
        <nav class="site-state motion-element">
        
          
            <div class="site-state-item site-state-posts">
              <a href="/archives">
                <span class="site-state-item-count">43</span>
                <span class="site-state-item-name">日志</span>
              </a>
            </div>
          

          
            <div class="site-state-item site-state-categories">
              <a href="/categories">
                <span class="site-state-item-count">19</span>
                <span class="site-state-item-name">分类</span>
              </a>
            </div>
          

          
            <div class="site-state-item site-state-tags">
              <a href="/tags">
                <span class="site-state-item-count">16</span>
                <span class="site-state-item-name">标签</span>
              </a>
            </div>
          

        </nav>

        
          <div class="feed-link motion-element">
            <a href="/atom.xml" rel="alternate">
              <i class="fa fa-rss"></i>
              RSS
            </a>
          </div>
        

        <div class="links-of-author motion-element">
          
            
              <span class="links-of-author-item">
                <a href="https://github.com/damon4u" target="_blank" title="GitHub">
                  
                    <i class="fa fa-fw fa-github"></i>
                  
                  GitHub
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="https://github.com/damon4u" target="_blank" title="weibo">
                  
                    <i class="fa fa-fw fa-weibo"></i>
                  
                  weibo
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="https://github.com/damon4u" target="_blank" title="zhihu">
                  
                    <i class="fa fa-fw fa-battery-3"></i>
                  
                  zhihu
                </a>
              </span>
            
          
        </div>

        
        

        
        

        


      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-4"><a class="nav-link" href="#SubTag"><span class="nav-number">1.</span> <span class="nav-text">SubTag</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#SubTagList"><span class="nav-number">2.</span> <span class="nav-text">SubTagList</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#SubTagsList"><span class="nav-number">3.</span> <span class="nav-text">SubTagsList</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#NameValue"><span class="nav-number">4.</span> <span class="nav-text">NameValue</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Attribute"><span class="nav-number">5.</span> <span class="nav-text">Attribute</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#一个包含id属性的基础标签"><span class="nav-number">6.</span> <span class="nav-text">一个包含id属性的基础标签</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#动态查询语句元素"><span class="nav-number">7.</span> <span class="nav-text">动态查询语句元素</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#带有请求参数的元素"><span class="nav-number">8.</span> <span class="nav-text">带有请求参数的元素</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#增删改查标签"><span class="nav-number">9.</span> <span class="nav-text">增删改查标签</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Insert"><span class="nav-number">10.</span> <span class="nav-text">Insert</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Delete"><span class="nav-number">11.</span> <span class="nav-text">Delete</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Update"><span class="nav-number">12.</span> <span class="nav-text">Update</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Select"><span class="nav-number">13.</span> <span class="nav-text">Select</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#resultMap"><span class="nav-number">14.</span> <span class="nav-text">resultMap</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#属性转换器PropertyConverter"><span class="nav-number">15.</span> <span class="nav-text">属性转换器PropertyConverter</span></a></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy;  2017 - 
  <span itemprop="copyrightYear">2018</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">五月y</span>
</div>


<div class="powered-by">
  由 <a class="theme-link" href="https://hexo.io" rel="external nofollow">Hexo</a> 强力驱动
</div>

<div class="theme-info">
  主题 -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next" rel="external nofollow">
    NexT.Mist
  </a>
</div>





        

<div class="busuanzi-count">

  <script async src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script>

  
    <span class="site-uv"><i class="fa fa-user"></i><span class="busuanzi-value" id="busuanzi_value_site_uv"></span></span>
  

  
    <span class="site-pv"><i class="fa fa-eye"></i><span class="busuanzi-value" id="busuanzi_value_site_pv"></span></span>
  
  
</div>



        
      </div>
    </footer>

    <div class="back-to-top">
      <i class="fa fa-arrow-up"></i>
    </div>
  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  


  



  
  <script type="text/javascript" src="//cdn.jsdelivr.net/jquery/2.1.3/jquery.min.js"></script>

  
  <script type="text/javascript" src="//cdn.jsdelivr.net/fastclick/1.0.6/fastclick.min.js"></script>

  
  <script type="text/javascript" src="//cdn.jsdelivr.net/jquery.lazyload/1.9.3/jquery.lazyload.min.js"></script>

  
  <script type="text/javascript" src="//cdn.jsdelivr.net/velocity/1.2.3/velocity.min.js"></script>

  
  <script type="text/javascript" src="//cdn.jsdelivr.net/velocity/1.2.3/velocity.ui.min.js"></script>

  
  <script type="text/javascript" src="//cdn.jsdelivr.net/fancybox/2.1.5/jquery.fancybox.pack.js"></script>

  
  <script type="text/javascript" src="/vendors/canvas-nest/canvas-nest.min.js"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.0"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.0"></script>



  
  

  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.0"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.0"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.0"></script>



  



  




	





  





  

  
      <!-- UY BEGIN -->
      <script type="text/javascript" src="http://v2.uyan.cc/code/uyan.js?uid="></script>
      <!-- UY END -->
  




  
  

  

  

  
<script>
(function(){
    var bp = document.createElement('script');
    var curProtocol = window.location.protocol.split(':')[0];
    if (curProtocol === 'https') {
        bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';        
    }
    else {
        bp.src = 'http://push.zhanzhang.baidu.com/push.js';
    }
    var s = document.getElementsByTagName("script")[0];
    s.parentNode.insertBefore(bp, s);
})();
</script>


  


  <!-- 页面点击小红心 -->
  <!-- <script type="text/javascript" src="/js/src/love.js"></script>
  -->
  <!-- 动态线条背景 http://shenzekun.cn/hexo%E5%A6%82%E4%BD%95%E6%B7%BB%E5%8A%A0%E5%8A%A8%E6%80%81%E8%83%8C%E6%99%AF.html -->
  <!--
    <script type="text/javascript" color="0,0,0" opacity='0.9' zIndex="-2" count="50" src="//cdn.bootcss.com/canvas-nest.js/1.0.0/canvas-nest.min.js"></script>
  
  -->
</body>
</html>
